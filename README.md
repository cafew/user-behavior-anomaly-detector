## About

User anomaly detector based on logs generated by Osquery framework and machine learning to process those logs.
Machine learnings alogirthms that are currently implemented are: Recurrent neural network - Long short-term memory (LSTM)
and One-Class Support Vector Machine (OCSVM). This project is part of Master thesis at Faculty of electrical engineering and computing, University of Zagreb.

**Note:** Only Linux platforms are supported. Tested on Xubuntu 16.04.

The code includes:
- dataset to train your models on
- preprocessing functions to properly tokenize the data
- train and predict functions for existing data
- saving and loading trained models
- predict functions for incoming new data


## Motivation

Existing security solutions are mostly based on preventing known malicious threats or a defined set of rules and therefore most outside and inside threats end as successful attacks.
The idea was to build a system that is an adaptive user action identifier, so it can predict and detect anomalous behavior in real time.

## Installation

###### osquery
- Download [osquery](https://osquery.io/downloads/).
- Move osquery pack of queries file `user-behavior.conf` and osquery configuration file `osquery.conf` from conf directory to osquery directory which is usually `/etc/osquery/` or `/usr/local/`.
- To capture syslog events additional configuration is required. 
Add the following to your rsyslog configuration files (usually located in `/etc/rsyslog.conf` or `/etc/rsyslog.d/`:
```
template(
  name="OsqueryCsvFormat"
  type="string"
  string="%timestamp:::date-rfc3339,csv%,%hostname:::csv%,%syslogseverity:::csv%,%syslogfacility-text:::csv%,%syslogtag:::csv%,%msg:::csv%\n"
)
*.* action(type="ompipe" Pipe="/var/osquery/syslog_pipe" template="OsqueryCsvFormat")
```

If you use syslog-ng or you can read about the configuration [here](https://github.com/facebook/osquery/blob/master/docs/wiki/deployment/syslog.md#linux-syslog).
If no logs are available, read [debugging suggestions](https://github.com/facebook/osquery/issues/1964).


###### Repository

- Download the repository using `git clone`.
- Install pip requirements with the following command: `sudo pip install -r requirements.txt`.
Python 2.7 is required. I don't guarantee that everything works with Python 3+ but please feel free to try.

## How to use

- Start osquery first i.e. `sudo service osqueryd start`.
- You can start the program by choosing the wanted algorithms i.e. `sudo python main.py -a OCSVM`.
    Default algorithm is LSTM. You can also change the queries result log file using the `-l` flag, default is `/var/log/osquery/osqueryd.results.log`.
    Osquery runs and writes files as sudo so we need our python script to run as root.

## License

[The MIT License](https://opensource.org/licenses/mit) Copyright (c) 2017-present